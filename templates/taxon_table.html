{% extends "default_base.html" %}


{% block body %}

<div class="filter_taxon_table">
  <h4>General Settings</h4>
  <div class="row">
    <div class="col-md-3">
      <div class="form-group">
        <label for="taxon_level_select">Taxonomy Level</label>
        <select class="form-control" id="taxon_level_select" name="function_class">
          {% for taxon_level in taxonomy_levels %}
            <option value="{{taxon_level}}">{{taxon_level}}</option>
          {% endfor %}
        </select>
      </div>
    </div>
    <input class="btn btn-default" id="updateTaxonTable" type="button" value="Update" onclick="fetch_new_table_data()"/>
  </div>
</form>
<button class="btn btn-default" id="toggle_full_taxonomy" value='show'>Show Full Taxonomy</button>
<button class="btn btn-default" id="toggle_sample_description" value='show'>Show Sample Information</button>

{% include 'taxon_actual_table.html' %}

<script type=text/javascript>
  $(document).ready(function () {
      enable_tooltip();
      hide_full_taxonomy();
      $( "#taxon_level_select option[value='{{current_level}}']" ).each(function() {
        $(this).prop('selected', true);
      });
      $('#toggle_full_taxonomy').click(function(event) {
        if ($(this).attr('value') == 'show') {
           $(this).text("Hide Full Taxonomy");
           $(this).attr('value', 'hide');
           show_full_taxonomy();
        } else {
           $(this).text("Show Full Taxonomy");
           $(this).attr('value', 'show');
           hide_full_taxonomy();
        }
      });

      hide_sample_information();
      $('#toggle_sample_description').click(function(event) {
        if ($(this).attr('value') == 'show') {
           $(this).text("Hide Sample Information");
           $(this).attr('value', 'hide');
           show_sample_information();
        } else {
           $(this).text("Show Sample Information");
           $(this).attr('value', 'show');
           hide_sample_information();
        }
      });
  });

  function fetch_new_table_data() {
    var taxon_level = $( "#taxon_level_select" ).val();
    var current_level = $( "#taxon_actual_table #taxonomy_table" ).attr("current_taxon_level");
    var parent_values = new Array();
    $(".rpkm_values_tbody input:checked").each(function(){
        parent_values.push($(this).val());
    });
    var url = "/taxonomy_table?" + $.param( { taxon_level: taxon_level, parent_values: parent_values,  parent_level: current_level } );
    window.location = url;
  };

  function enable_tooltip() {
    $('[data-toggle="tooltip"]').tooltip();
  }

  function show_full_taxonomy(){
    $('#taxonomy_table thead .full_taxonomy').show();
    $('#taxonomy_table tbody .full_taxonomy').show();
  }

  function hide_full_taxonomy(){
    $('#taxonomy_table thead .full_taxonomy').hide();
    $('#taxonomy_table tbody .full_taxonomy').hide();
  }

  function show_sample_information(){
    $('#taxonomy_table thead .sample_description_in_table').show();
  }

  function hide_sample_information(){
    $('#taxonomy_table thead .sample_description_in_table').hide();
  }
</script>
{% endblock body %}
